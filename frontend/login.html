<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½• - é‚®ä»¶æ±‡æ€»ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/frontend/static/css/base.css">
    <link rel="stylesheet" href="/frontend/static/css/auth.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <!-- å¡ç‰‡å¤´éƒ¨ -->
            <div class="auth-header">
                <div class="auth-logo">ğŸ“§</div>
                <h1 class="auth-title">é‚®ä»¶æ±‡æ€»ç³»ç»Ÿ</h1>
                <p class="auth-subtitle">æ¬¢è¿å›æ¥ï¼Œè¯·ç™»å½•æ‚¨çš„è´¦å·</p>
            </div>

            <!-- å¡ç‰‡ä¸»ä½“ -->
            <div class="auth-body">
                <form id="loginForm">
                    <!-- è´¦å· -->
                    <div class="form-group">
                        <label class="form-label form-label-required">è´¦å·</label>
                        <input 
                            type="text" 
                            class="auth-input" 
                            id="account" 
                            name="account"
                            placeholder="è¯·è¾“å…¥è´¦å·ã€ç”¨æˆ·åæˆ–é‚®ç®±"
                            required
                            autocomplete="username"
                        >
                        <div class="form-error" id="accountError"></div>
                    </div>

                    <!-- å¯†ç  -->
                    <div class="form-group">
                        <label class="form-label form-label-required">å¯†ç </label>
                        <input 
                            type="password" 
                            class="auth-input" 
                            id="password" 
                            name="password"
                            placeholder="è¯·è¾“å…¥å¯†ç "
                            required
                            autocomplete="current-password"
                        >
                        <div class="form-error" id="passwordError"></div>
                    </div>

                    <!-- æäº¤æŒ‰é’® -->
                    <button type="submit" class="auth-submit" id="loginBtn">
                        ç™»å½•
                    </button>
                </form>

                <!-- åº•éƒ¨é“¾æ¥ -->
                <div class="auth-footer">
                    è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ
                    <a href="/frontend/register.html" class="auth-link">ç«‹å³æ³¨å†Œ</a>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥ JS æ–‡ä»¶ -->
    <script src="/frontend/static/js/utils.js"></script>
    <script src="/frontend/static/js/api/common.js"></script>
    <script src="/frontend/static/js/api/auth.js"></script>
    
    <script>
        // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
        if (Utils.isAuthenticated()) {
            window.location.href = '/frontend/index.html';
        }

        // è¡¨å•æäº¤å¤„ç†
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯æç¤º
            document.getElementById('accountError').textContent = '';
            document.getElementById('passwordError').textContent = '';

            // è·å–è¡¨å•æ•°æ®
            const account = document.getElementById('account').value.trim();
            const password = document.getElementById('password').value;

            // å‰ç«¯éªŒè¯
            if (!account) {
                document.getElementById('accountError').textContent = 'è¯·è¾“å…¥è´¦å·';
                return;
            }

            if (!password) {
                document.getElementById('passwordError').textContent = 'è¯·è¾“å…¥å¯†ç ';
                return;
            }

            // ç¦ç”¨æäº¤æŒ‰é’®
            const loginBtn = document.getElementById('loginBtn');
            loginBtn.disabled = true;
            loginBtn.textContent = 'ç™»å½•ä¸­...';

            try {
                // è°ƒç”¨ç™»å½• API
                const result = await AuthAPI.login(account, password);

                if (result.success) {
                    // ç™»å½•æˆåŠŸï¼Œç›´æ¥è·³è½¬ï¼Œä¸æ˜¾ç¤ºæç¤º
                    window.location.href = '/frontend/index.html';
                } else {
                    // æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
                    const errorMsg = result.message || 'è´¦å·æˆ–å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•';
                    alert(errorMsg);
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'ç™»å½•';
                }
            } catch (error) {
                console.error('ç™»å½•å¤±è´¥:', error);
                alert('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•');
                loginBtn.disabled = false;
                loginBtn.textContent = 'ç™»å½•';
            }
        });

        // Enter é”®æäº¤
        document.getElementById('password').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('loginForm').dispatchEvent(new Event('submit'));
            }
        });
    </script>
</body>
</html>
